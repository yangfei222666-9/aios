# 2026-02-19 日志

## 重大里程碑：自治控制环完成
珊瑚海提出三个战略优先级，全部在一个下午 MVP 落地：

### 1. 闭环状态机 (alert_fsm.py)
- OPEN → ACK → RESOLVED 完整流转
- 指纹去重 (rule_id + scope + day_bucket)
- SLA: CRIT 1h / WARN 24h / INFO 72h
- 连续恢复2次自动 RESOLVED
- ACK → OPEN 反开（问题复发）
- 审计日志 alerts_history.jsonl
- 验收: 17/17 PASS

### 2. 变更保险丝 (safe_run.py)
- 风险分级: LOW/MEDIUM/HIGH/CRIT
- HIGH+ 无 --confirm 硬拒绝
- 执行前自动快照，失败自动回滚
- 审计日志 changes_log.jsonl
- CLI: plan / apply / rollback / log / stats
- 验收: 17/17 PASS

### 3. 任务队列 (job_queue.py)
- QUEUED → RUNNING → SUCCESS/FAILED/RETRY/DEAD
- 指数退避重试 (1m/5m/15m, 最大3次)
- 幂等保护 (idempotency_key)
- 崩溃恢复 (RUNNING → QUEUED)
- 死信队列
- CLI: enqueue / worker / list / dead / stats / recover
- 验收: 19/19 PASS

### 系统架构升级
从"会干活的助手"升级为"可治理的自动化系统"：
- 监测层：异常分级 + 冷却 + 心跳巡检
- 管理层：OPEN/ACK/RESOLVED 闭环 + SLA + 审计
- 预防层：高风险门禁 + dry-run + confirm + 回滚
- 执行层：队列化 + 重试 + dead-letter + 可追踪

### 下一步
- 进入14天稳态运营期
- 等珊瑚海给运营看板模板
- 盯三组指标：告警质量、变更安全、队列健康

## 其他
- Whisper 语音转文字功能调通（small 模型，CPU 模式）
- 发现：极短音频(<2s) Whisper 会产生幻觉（"字幕by索兰娅"）
- ffmpeg 已安装但需手动加 PATH
- ClawdHub 重试 cron 已禁用（持续限速）
- whisper_transcribe.py 脚本化，后续语音消息可复用
