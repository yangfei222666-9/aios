# 2026-02-20 日志

## 心跳任务（07:02 手动触发）
- 异常检查：全绿（CRIT:0 WARN:0 INFO:5）
- AIOS 基线快照：evolution_score=0.3396 grade=healthy
- TSR: 96.02%, CR: 11.11%, 502: 0%
- exec p95 偏高 (6640ms)，其余正常
- 记忆整理：已执行

## 模型切换约定（08:24）
- 日常模式：claude-sonnet-4-5（快速响应）
- 工作模式：claude-opus-4-6（复杂任务）
- 口令："切工作模式" / "切日常模式"（手动覆盖仍有效）
- 自动切换规则（09:47 升级）：
  - 开始干活（改代码/跑测试/多文件操作）→ 自动切 opus，提示"🔧 切工作模式"
  - 干完活 / 进入闲聊 → 自动切 sonnet，提示"💬 切日常模式"
  - 判断依据：我自己的工作量，不是用户消息内容
  - 切换时机：任务开始前 / 任务结束后

## WSL + wacli 安装（07:42-08:22）
- WSL Ubuntu 安装成功
- Go 1.26.0 + wacli 编译成功
- WhatsApp 扫码绑定成功（AUTHENTICATED = true）
- wacli send 命令在 WSL 里一直卡住，网络连接问题未解决
- 结论：wacli 在 WSL 环境下不稳定，暂时搁置

## AIOS insight.py 修复（08:35-08:43）
- insight.py: 致命事件统计拆分为"真实致命事件/测试事件"
- insight.py: 死循环检测排除 deploy/restart/rollout 批量事件窗口
- alerts.py: 保持 CRIT:0 现有规则口径不变
- baseline.py: 不变；evolution_score/grade 继续由 evolution_score() 基于历史快照实时计算
- Commit: fix(insight): separate test critical events and exclude deploy/restart windows

## Whisper GPU 升级（07:02-07:14）
- PyTorch 从 CPU 版 2.10.0 升级到 CUDA 12.8 版
- RTX 5070 Ti 识别成功，torch.cuda.is_available() = True
- Whisper 模型从 small 升级到 medium，GPU 加载 6 秒，占用 ~2.9GB 显存
- whisper_transcribe.py 已更新为 device='cuda'

## 三项提升（09:27-09:38）
### Autolearn v1.1.0 模糊匹配可解释性
- lessons.py find() 升级为三层匹配：strict → loose → fuzzy (Jaccard)
- 每条结果带 _match_type、_similarity_score、_matched_keywords
- 测试 8/8 全绿

### exec p95 偏高排查与修复
- 根因：195 条旧格式模拟数据污染了 baseline
- 清理后：exec p95 从 6640ms → 300ms，evolution_score 从 0.3396 → 0.4（满分）

### AIOS v0.3 感知层
- event_bus.py：进程内 pub/sub + 通配符订阅 + 文件队列跨会话通信
- sensors.py：FileWatcher / ProcessMonitor / SystemHealth
- dispatcher.py：感知→分发→行动建议
- 集成到 alerts.py，测试 5/5 全绿
- Sensors cooldown + Dispatcher trace_id

## 自动模型切换策略（09:46-09:51）
- v2（min_dwell=3, up=0.72, down=0.45）：9/10 准确率
- v3（灰区+dwell累积+时间冷却）：4/10 准确率，过于保守
- 教训：简单机制 > 复杂机制

## 14天运营期数据收集（09:58-10:02）
- ops_metrics.py：每日收集 MTTR / Noise Rate / Retry Yield / Rollback Safety
- ops_weekly.py：周报生成器
- 每日 9:10 cron 自动收集

## AIOS 感知层扩展（10:01-10:02）
- NetworkProbe：ping 8.8.8.8 / 1.1.1.1 / api.anthropic.com
- Cooldown 10分钟，测试 7/7 全绿

## 执行器治理 + 监控修复（11:57-12:06）
- engine.py: emit 新增 severity 字段，_classify_severity() 统一 fatal→CRIT
- alerts.py: 新增规则6（事件严重度/死循环检测）+ 规则7（执行器绕过检测）
- executor.py: idempotency_guard + preflight_check + classify_error + execute()
- 终态：SUCCESS / NOOP_ALREADY_RUNNING / NOOP_DEDUP / FAILED_RETRYABLE / FAILED_NON_RETRYABLE
- 契约测试 17/17 PASS

## 别名归一化 app_alias.py
- resolve(raw_text) → canonical name + action + process_name + exe_path
- 繁简归一化 + ASR 错词别名
- 测试 6/6 PASS

## 自我反省（12:14-12:27）
- 语音转写后没有自动执行，同一个错误重复了5次
- 根因：消息处理优先级问题——总是先"思考和回复"再"执行"
- **这是最大的短板：知道该做但没做，说到没做到**

## 晚间：AIOS 趋势对比 (21:22-21:25)
- 新增 aios/learning/trend.py：三维度对比（事件量/结构占比/成功质量）+ 阈值判定
- 首次对比结果：事件量偏低92%（系统空闲）、TOOL占比突增55%（样本小）
- 实际状态健康：TSR 100%、零重试、零时延
- 新增每日 9:20 cron 自动趋势对比，超阈值才推送
