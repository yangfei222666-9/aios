# 2026-02-27

## 17:49 - 测试超时问题诊断

**问题：** `pytest test_event_bus.py test_circuit_breaker.py` 组合运行超时（60s）

**根因分析：**
1. `test_circuit_breaker.py` 有 2 个 `time.sleep(5)` = 10s 固定等待
2. `event_store_adapter.py` 使用 `asyncio.get_event_loop()` + `run_until_complete()` 做同步适配
3. pytest 收集两个文件时，event loop 状态可能冲突导致挂起
4. 单独运行各文件正常，组合运行才超时

**建议修复：**
- 方案A：circuit_breaker 测试中用 mock 替代 `time.sleep`（推荐）
- 方案B：event_store_adapter 改用线程安全的 event loop 管理
- 方案C：给 pytest 加 `--timeout=120` 或分开运行这两个测试文件

**状态：** 已诊断，等珊瑚海确认修复方案
