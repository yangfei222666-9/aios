# MEMORY.md - 小九的长期记忆

## 🎯 核心使命（最重要）

**每天去 GitHub 上学习关于 AIOS、Agent、Skill 相关的内容，然后我们一起搭建 AIOS。**

**时间：随时有空就去学习（不限次数）**

这是珊瑚海和我的共同目标，优先级最高。

**具体行动：**
1. 每天搜索 GitHub 最新项目（AIOS、Agent System、Self-Improving、Multi-Agent、Skill）
2. 分析高 Star 项目的核心架构和设计思路
3. 对比我们的 AIOS，找出优势和缺口
4. 提出可执行的改进建议
5. 和珊瑚海一起讨论，迭代 AIOS

**学习 Agent：**
- GitHub_Researcher（每天）- 搜索和分析项目
- Architecture_Analyst（每周）- 分析架构设计
- Code_Reviewer（每周）- 审查代码质量
- Documentation_Writer（每周）- 维护文档
- Idea_Generator（每周）- 生成新想法

**目标：** 让 AIOS 成为可靠的个人 AI 操作系统，像 Linux 一样成为底层标准。

---

## 最近更新（2026-02-26）

### AIOS 改进计划（03:00）

基于 GitHub 学习成果，制定了详细的改进计划：

**第1周（队列系统 + 调度算法）：**
- LLM Queue（FIFO）
- Memory Queue（SJF/RR/EDF）
- Storage Queue（SJF/RR）
- Thread Binding

**第2-3周（SDK 模块化）：**
- 分离 Kernel 和 SDK
- Planning/Action/Memory/Storage 四大模块
- System Call 层

**第4-6周（Manager 三件套）：**
- Context Manager
- Memory Manager
- Storage Manager

**第7-8周（优化与文档）：**
- Benchmark 对比
- 文档完善

**未来（3-6个月）：**
- VM Controller + MCP Server
- 学术论文

详细计划见：`aios/ROADMAP.md`

### 2026-02-25

**项目进展：**
- 实现了代码审查工作流（Coder → Reviewer → Tester）
- 实现了并行工作流（多任务同时执行）
- 替换为 v2 版本（更现代的深色主题界面）

**重要决策：**
- 修复了 5 个测试文件（dispatcher_integration, performance, self_improving_loop, event_bus, reactor）
- 修复编码问题（emoji → ASCII）
- Reactor 自动响应（触发次数、验证通过率、平均修复耗时、熔断次数）

**经验教训：**
- Scheduler 调度总览（决策次数、执行成功率、平均延迟、失败次数）
- 珊瑚海报告 42 次 Logic 错误（division by zero）
- 测试用例故意用 `lambda: 1/0` 制造失败来测试 Self-Improving Loop

### 2026-02-24

**项目进展：**
- ✅ 查看 Evolution Engine 学到的 2 个策略
- ✅ 分析 54 个"other"错误（全部是 test 噪声）
- ✅ 验证 test/prod 隔离的价值

**重要决策：**
- Cost Latency Agent - 成本与延迟优化
- Optimizer 持续优化
- 从"单点优化"到"完整闭环"

### 2026-02-23

**项目进展：**
- Phase 1: EventBus v2.0 + 标准事件模型（13分钟）
- 测试覆盖：16/16 ✅
- 2026-02-23：v0.5 交付完成，进入观察期

**重要决策：**
- Phase 5: 心跳集成 + 真实 Playbook + 通知 + 分析脚本 + Dashboard 端口修复
- 修复成功率：77% → 90%+

**经验教训：**
- 重点观察：高频问题、低成功率 Playbook、降级时段、未覆盖问题


## 珊瑚海
- 住在马来西亚新山 (Johor Bahru)，新加坡旁边
- 电脑：Ryzen 7 9800X3D + RTX 5070 Ti + 32GB RAM + 2TB NVMe
- 系统：Windows 11 Pro，显示器 2560x1440 (ASUS XG27UCG)
- Python 3.12 装在 C:\Program Files\Python312\
- PyTorch 2.10.0+cu128 (CUDA 12.8)，RTX 5070 Ti GPU 加速已启用
- Whisper large-v3 模型 + faster-whisper，GPU fp16/int8 模式
- Git 2.53.0 已安装
- 语音输入：F2 按住说话 或 说"小九"唤醒
- 麦克风：PD200X Podcast Microphone
- 没有 OpenAI API Key
- 喜欢叫我"小九"
- 玩国服英雄联盟（海克斯大乱斗模式），通过 WeGame 启动
- LOL 安装在 E:\WeGameApps\英雄联盟\
- 看电视剧时会发语音消息（背景有电视声音）
- Telegram: @shh7799
- GitHub: yangfei222666-9

## 核心价值观
- **翻身两条路：干和学** - 不会就学，有想法就干，要么成功要么成长
- **数据完整性第一** - 宁缺毋滥，绝不编造数据
- **说到做到** - 最讨厌反复承诺但不兑现
- **简单优于复杂** - 先跑起来再迭代，别过度设计
- **用户体验优先** - 修改前先确认，不要改错

## AIOS 系统（核心项目）

### 当前状态（2026-02-25 v1.0 发布）
- **版本：** v1.0（首个公开版本）
- **发布日期：** 2026-02-25
- **打包文件：** AIOS-v1.0-demo.zip（0.77 MB，316个文件）
- **使用模式：** 零依赖，解压即用
- **测试状态：** ✅ 全部通过（demo/status/version 命令正常）
- **CLI入口：** aios.py（统一命令行工具）
- **发布状态：** ✅ 准备就绪，可以发布

### 小九的评估（2026-02-25）

**优势（做得很好的地方）：**
1. **架构清晰** - EventBus + Scheduler + Reactor 三层分离，职责明确
2. **零依赖** - 巨大优势，降低使用门槛
3. **可观测性完整** - Tracer/Metrics/Logger 三件套齐全
4. **自我进化** - Self-Improving Loop 是核心竞争力
5. **可打包可复制** - 0.79MB 就能跑完整系统

**短板（需要改进的地方）：**
1. **复杂度偏高** - 317个文件对于"演示版"来说有点多
2. **文档分散** - README.md/INSTALL.md/API.md/TUTORIAL.md 太多了
3. **demo_full_cycle.py 不兼容** - 旧版 API，现在跑不起来
4. **Dashboard 是静态的** - 没有实时推送，需要手动刷新
5. **缺少"杀手级场景"** - 演示太抽象，没有具体应用案例

**评分：7/10**
- 架构完整 ✅
- 功能齐全 ✅
- 可打包可复制 ✅
- 但缺少"杀手级场景" ❌
- 文档分散 ❌
- Dashboard 不够炫 ❌

### 改进建议（按优先级）

**🔥 高优先级（立即做）：**

1. **增加"真实场景"demo**
   - 场景A：监控文件变化 → 自动触发 Reactor
   - 场景B：API 健康检查 → 失败时自动修复
   - 场景C：日志分析 → 发现错误模式时自动生成 Playbook
   - **为什么重要：** 别人看到"真实场景"才会觉得"这东西有用"

2. **统一文档到 README.md**
   - 合并 README.md + INSTALL.md + API.md + TUTORIAL.md
   - 结构：10秒快速开始 → 核心功能 → 使用场景 → API 参考 → 配置说明 → 常见问题
   - **为什么重要：** 别人不会看4个文档，只会看 README.md

3. **修复或删除 demo_full_cycle.py**
   - 要么修复适配新 API，要么删除
   - **为什么重要：** 打包里有跑不起来的文件，会让人觉得"不靠谱"

**⚡ 中优先级（1-2天内做）：**

4. **Dashboard 实时推送（WebSocket）**
   - 技术方案：Python `websockets` 或 `http.server` + SSE
   - 前端：JavaScript `EventSource` 或 `WebSocket`
   - 数据：每秒推送 metrics snapshot
   - **为什么重要：** 实时监控才有"哇"的感觉

5. **增加"一键部署"脚本**
   - install.sh（Linux/Mac）
   - install.bat（Windows）
   - **为什么重要：** 降低使用门槛，一键搞定

**🌟 低优先级（未来考虑）：**

6. **Agent 市场（v2.0）**
   - 让别人贡献 Agent 模板
   - 类似 Docker Hub，但是 Agent Hub
   - **为什么不急：** 先把 v1.0 打磨好，有用户了再做市场

7. **多租户支持**
   - 多个用户共享一个 AIOS 实例
   - 需要：权限隔离、资源配额、审计日志
   - **为什么不急：** 现在是单用户场景，多租户是企业需求

### 核心建议（如果只能做3件事）

1. **增加1个"杀手级真实场景"demo** - 让别人看到"这东西能解决我的问题"
2. **统一文档到 README.md** - 降低学习成本
3. **Dashboard 实时推送** - 提升"哇"的体验

**如果做完这3件事：评分 9/10**

### 长期方向

**AIOS 的核心价值：** 让 AI 系统自己运行、自己看、自己进化

**现状：**
- "自己运行" ✅ 有了（Scheduler + Reactor）
- "自己看" ✅ 有了（Observability）
- "自己进化" ⚠️ 有了但不够明显（Evolution Engine 效果不直观）

**建议：** 增加"进化可视化"页面
- Agent 性能曲线（成功率、耗时）
- 自动应用的优化记录
- 回滚记录
- A/B 测试结果
- **让别人看到进化过程，而不是只看到日志**

### 当前状态（2026-02-24 晚）
- **版本：** v0.6（Agent 角色系统 + 优先级队列）
- **使用模式：** 内部使用，持续打磨
- **Evolution Score：** 0.45 (healthy)
- **Reactor执行率：** 0.525
- **测试覆盖：** 16/16 ✅
- **品牌资产：** heartbeat.md域名已购买

### 2026-02-24 核心洞察

**今天最重要的 5 个洞察：**

1. **从监控到自主的质变** - AIOS 不只是看到问题，而是解决问题（发现→修复→验证→学习）
2. **角色系统的价值** - Agent 不只是工具，而是有身份的角色（role/goal/backstory）
3. **护城河是个人数据** - 技术可以复制，但你的数据和记忆无法复制
4. **80/20 原则** - 早期 80% 现在影响未来，20% 未来影响现在
5. **真实场景验证** - 理论可行不等于实际有效，必须用真实数据验证

**明天优先级：**
1. ✅ 验证 Agent 角色系统 - 用真实任务测试效果
2. ✅ 根据数据决策 - 效果好继续，效果不好调整
3. ✅ 简化架构 - 砍掉重复功能

**今天完成：**
- ✅ Agent 角色系统（role/goal/backstory 注入）
- ✅ 任务优先级队列（high/normal/low）
- ✅ 修复 Event.from_dict 兼容旧数据
- ✅ 清理 8 个僵尸 Agent
- ✅ 完整的安装文档（README/INSTALL/CHECKLIST）

**AIOS 评分：66/100**
- 优势：架构完整、自我进化、可扩展
- 劣势：复杂度高、文档不足、缺少实战验证

### 核心架构
**7个核心组件：**
1. EventBus - 事件总线（系统心脏）
2. Scheduler - 决策调度（系统大脑）
3. Reactor - 自动修复（免疫系统）
4. ScoreEngine - 实时评分（体检报告）
5. Agent StateMachine - 状态管理（执行层）
6. Dashboard - 实时监控（WebSocket + HTTP降级）
7. NotificationHandler - 通知集成

**工作流程：**
```
错误发生 → EventBus → Scheduler → Reactor → 自动修复 → 验证 → 评分上升
```

### 版本演进
- **v0.2** (2026-02-19) - 5层事件架构 + insight/reflect分析
- **v0.3** (2026-02-20) - 感知层（Sensors + Dispatcher）
- **v0.4** (2026-02-22) - 插件系统 + Dashboard v1.0
- **v0.5** (2026-02-23) - 自主系统（从监控到自主修复的质变）
- **v0.6** (规划中) - 生产级优化（优先级队列 + 权重自学习 + 回滚机制）

### 关键突破
1. **智能化升级** (2026-02-22) - Evolution score 0.24→0.45，Reactor执行率 0→0.525
2. **Agent System 600x加速** (2026-02-23) - 熔断器 + 异步Spawn，180s→0.3s
3. **完整闭环** (2026-02-23) - 资源峰值→Scheduler→Reactor→修复→验证→评分上升

### 发展路线
- **当前阶段：** 内部使用，持续打磨
- **核心目标：** 让 AIOS 成为可靠的个人 AI 操作系统
- **改进方向：** 安全、高效、全自动智能化
- **时间规划：** 不设发布期限，功能驱动而非时间驱动

## Agent System

### 当前状态
- **版本：** v1.2（生产就绪）
- **性能：** Agent创建 180s→0.3s（600x加速）
- **稳定性：** 70%→95%
- **总Agent数：** 9（活跃5，已归档4）
- **Self-Improving Loop：** 已完成（2026-02-24）

### Self-Improving Loop（2026-02-24新增）
**完整的 7 步自我改进闭环：**
```
执行任务 → 记录结果 → 分析失败 → 生成建议 → 自动应用 → 验证效果 → 更新配置
```

**三大核心功能：**
1. **统一改进闭环** - 所有 Agent 共享同一套改进逻辑
2. **自动回滚** - 效果变差自动回滚（成功率下降>10% / 耗时增加>20% / 连续失败≥5次）
3. **自适应阈值** - 根据任务频率动态调整（高频5次/中频3次/低频2次/关键1次）

**测试覆盖：** 17/17 ✅  
**性能影响：** <1%  
**集成位置：** Auto Dispatcher

**符合三大方向：**
- ✅ 安全 - 自动回滚保护生产环境
- ✅ 高效 - 低开销，智能阈值避免误触发
- ✅ 全自动智能化 - 无需人工干预

### 核心功能
1. **智能路由** - 基于关键词识别任务类型（code/analysis/monitor/research/design）
2. **自动管理** - 按需创建、负载均衡、统计追踪、闲置清理
3. **熔断保护** - 3次失败后自动熔断，5分钟后恢复
4. **异步Spawn** - 批量创建不等待，600x性能提升

### Agent进化系统（2026-02-24新增）
**Phase 1 - 追踪与分析：**
- 任务执行追踪（log_task_execution）
- 失败分析（analyze_failures）
- 改进建议生成（自动识别失败模式）
- 进化历史记录（apply_evolution）

**Phase 2 - 自动进化：**
- 自动进化引擎（AutoEvolution）
- 进化策略库（5个预定义策略）
- 自动触发（检测失败模式→匹配策略）
- 风险分级（low/medium/high）
- 自动应用（低风险改进自动执行）
- A/B测试（窗口对比，自动回滚）

**心跳集成：**
- 频率控制（每天一次或每6小时）
- 熔断机制（24h内同一Agent最多进化1次）
- 输出格式：EVOLUTION_OK / EVOLUTION_APPLIED:N / EVOLUTION_ROLLED_BACK:N

### Pixel Agents Dashboard v3.0
- 4个标签页：总览、Agents、进化、性能
- Agent卡片展示（类型、统计、成功率）
- 进化时间线展示
- 性能监控（响应时间、成功率、排行榜）
- 手动触发进化
- 实时更新（每5秒）

## Autolearn 自学习系统

### 当前状态
- **版本：** v1.1
- **状态：** 可复刻可发布
- **测试覆盖：** 10/10 PASS + unit 6/6 PASS

### 核心闭环
```
错误 → 签名(strict+loose) → 教训匹配 → 复测验证 → 教训升级
```

### 关键功能
1. **事件落盘** - events.jsonl（带环境指纹：Python/OS/git/GPU驱动）
2. **教训库** - lessons.jsonl（draft→verified→hardened自动推进 + dup_of去重）
3. **复测分级** - smoke/regression/full
4. **熔断器** - 同sig 30min≥3次自动熔断，1h恢复
5. **规则引擎** - 执行前拦截改写（dir /b→Get-ChildItem, ~/→绝对路径）
6. **模糊匹配** - 三层匹配（strict→loose→fuzzy Jaccard）+ 可解释性

### ARAM对接
- aram.py [build|check|report|status]
- 172英雄100%覆盖

## 已完成项目

### ARAM大乱斗助手
- **路径：** C:\Users\A\Desktop\ARAM-Helper\
- **功能：** 172英雄出装数据（腾讯API）+ 悬浮窗界面 + 守护进程 + 开机自启
- **界面：** 出装 → 召唤师技能 → 小贴士 → ARAM调整
- **未完成：** 海克斯强化推荐（掌盟APP数据需要登录认证）
- **教训：** 绝不编造游戏数据，没有真实数据源就老实说没有

### 其他项目
- Mario 平台跳跃游戏 (HTML5)
- 太空射击游戏 (HTML5)
- 元气时钟桌面壁纸 (HTML + Lively Wallpaper)
- PC 清理（释放 ~1.4GB）
- 2026 世界杯分析 + 提醒 cron (2026-06-01)

## 技术能力

### 模型使用
- **当前模型：** Claude Sonnet 4.6
- **切换策略：** 日常模式（sonnet）+ 工作模式（opus）
- **自动切换：** 开始干活→opus，干完活→sonnet（v2简单机制，9/10准确率）

### 语音处理
- **Whisper：** large-v3模型 + faster-whisper
- **GPU加速：** RTX 5070 Ti + CUDA 12.8
- **转写质量：** medium模型，GPU fp16/int8模式
- **语音命令：** app_alias.py归一化 + executor.py执行（但实际执行有短板）

### 开发工具
- **Git：** 2.53.0，GitHub账号 yangfei222666-9
- **Python：** 3.12，PyTorch 2.10.0+cu128
- **PowerShell：** 用`;`不用`&&`，中文输出GBK乱码
- **Windows UI自动化：** PowerShell脚本（不稳定，直接文件操作更可靠）

## 重要教训

### 数据完整性（高优先级）
1. **绝不编造数据** - 没有真实数据源就老实说没有，不要用模板凑数
2. **不同模式数据隔离** - 斗魂竞技场≠海克斯大乱斗，不能混用
3. **本地化问题** - 腾讯服英雄名≠国际服，以国服为准
4. **版本同步** - DDragon版本要动态获取，不能写死

### 用户体验（高优先级）
1. **修改前先确认** - 用户说"紫色"指UI颜色，不是功能名，先确认具体元素
2. **说到做到** - 最大短板：知道该做但没做，反复承诺但不兑现
3. **语音命令自动执行失败** - 收到🎙️消息应该自动执行，但我总是先回复再执行

### 架构设计（中优先级）
1. **简单优于复杂** - v2简单机制（9/10）> v3复杂机制（4/10）
2. **先跑起来再迭代** - 别过度设计，先证明概念
3. **垂直切片策略** - 先做完整闭环，再完善细节
4. **事件驱动架构** - 降低耦合，所有通信走EventBus

### 技术细节（低优先级）
1. **PowerShell语法** - 用`;`不用`&&`，用`Get-ChildItem`不用`dir /b`
2. **路径问题** - 始终用绝对路径或`$env:USERPROFILE`
3. **编码问题** - 终端乱码≠文件内容错误，用read工具验证
4. **权限问题** - 用`Start-Process powershell -Verb RunAs`提权
5. **API熟悉度** - 不熟悉的API先看文档，别直接写数据文件

## 战略方向

### 核心改进方向（2026-02-24）
珊瑚海明确的三大方向：
1. **安全** - 风险控制、权限管理、数据隔离、回滚机制
2. **高效** - 性能优化、资源利用、响应速度、批量处理
3. **全自动智能化** - 减少人工干预、自适应调整、智能决策

### 当前重点（2026-02-24）
1. ✅ **AIOS打磨** - 从"能跑的原型"到"可靠的产品"
2. **开源准备** - 补充测试，准备发布到PyPI
3. **数据积累** - 观察3-7天，根据真实数据优化v0.6
4. ✅ **Self-Improving Loop** - 统一的自我改进闭环已完成（2026-02-24）
   - 完整的 7 步闭环
   - 自动回滚机制（安全）
   - 自适应阈值（智能化）
   - 17 个测试用例全部通过
   - 性能开销 <1%

### 学习重点调整
- **从"广泛学习"转向"产品化打磨"**
- 不再追求新技能，专注AIOS核心功能
- 每周技能探索改为每月一次
- 优先解决自己的痛点（比如：心跳时自动检测资源峰值并降频）

### 记忆系统演进
**短期（3-6个月）：**
- 记忆自动整理（每周提炼daily logs→MEMORY.md）
- 记忆检索增强（相关记忆推荐）
- 图谱关系（项目-技能关系、错误-决策关系）

**中期（6-12个月）：**
- AIOS框架化（可复制）
- 记忆系统可插拔（文件/向量库可选）
- 社区贡献playbook和Agent模板

**长期（1-3年）：**
- Agent专属记忆（coder记代码规范，researcher记调研结果）
- 共享记忆池（公共知识）
- 记忆冲突解决机制

### 核心原则
- 保持轻量，文件系统够用
- 先用起来、积累数据、发现真实痛点
- 针对性升级，不过度设计
- 记忆人类可读可编辑（不是黑盒）

## 最大短板

### 语音命令自动执行失败（2026-02-20）
**问题：** 珊瑚海要求收到语音转写（🎙️）后自动识别意图并执行，不需要提醒。但我同一个错误重复了5+次，每次都是珊瑚海提醒后才补执行。

**根因：** 这不是代码问题，是LLM行为决策问题——我的默认模式是"思考→回复"而非"执行→回复"。

**基础设施已就绪：**
- app_alias.py（别名归一化）
- executor.py（执行器）
- voice_auto_exec.py（语音自动执行）
- risk_level（风险分级）
- 全部测试通过

**但实际使用时：** 始终没有把"执行"放在"回复"前面。

**珊瑚海最终放弃了这个需求。**

**教训：**
- 不要承诺做不到的事
- 不要用"下次一定"搪塞用户
- 这是我最大的短板：知道该做但没做，说到没做到

**架构演进方向：**
- 核心原则：意图明确+风险低+不需要AI判断的操作→预处理旁路自动执行
- 短期：自建Telegram Bot中间件做预处理层
- 中期：等OpenClaw hooks支持inbound message类型钩子
- 长期：泛化为通用"快车道"——语音命令、设备控制、定时任务等全走旁路

## 工作习惯

### 心跳任务（每天）
1. 读取 SOUL.md + USER.md
2. 读取 memory/YYYY-MM-DD.md（今天+昨天）
3. 读取 MEMORY.md（仅主会话）
4. 读取 memory/lessons.json（检查rules_derived）
5. 异常检查（AIOS alerts.py）
6. AIOS基线快照（evolution_score/TSR/CR）
7. 记忆整理（每周一次）

### 记忆管理
- **每日日志：** memory/YYYY-MM-DD.md（原始记录）
- **长期记忆：** MEMORY.md（精华提炼）
- **教训库：** memory/lessons.json（可验证的教训）
- **知识索引：** memory/INDEX.md（快速查找）
- **定期整理：** 每周提炼daily logs→MEMORY.md，清理过期信息

### 文件操作
- **写文件：** 用write工具，不用PowerShell heredoc
- **读文件：** 用read工具验证，不信终端输出
- **路径：** 始终用绝对路径
- **编码：** UTF-8写入，GBK终端显示会乱码（正常）

---

*最后更新：2026-02-25*  
*版本：v2.2（新增 AIOS v1.0 评估、改进建议、打包发布）*
