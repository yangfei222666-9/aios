# 个人习惯学习系统 v1.0 设计文档

## 项目目标
基于 AIOS 现有基础设施，构建一个能够学习珊瑚海个人习惯的智能系统，提供主动建议和优化。

## 核心原则
1. **被动收集，主动建议** — 不打扰日常使用，但在关键时刻给出有价值的建议
2. **隐私优先** — 所有数据本地存储，不上传
3. **渐进式学习** — 从简单规则开始，逐步积累数据后升级到模式识别
4. **可解释性** — 每个建议都能说清楚"为什么"

## 系统架构

### 数据层（Data Layer）
```
aios/learning/habits/
├── tracker.py          # 数据收集器
├── analyzer.py         # 模式分析器
├── predictor.py        # 行为预测器
└── data/
    ├── app_usage.jsonl      # 应用使用记录
    ├── daily_summary.jsonl  # 每日汇总
    ├── patterns.json        # 识别出的模式
    └── predictions.json     # 预测结果
```

### 分析维度

#### 1. 时间维度
- **小时级**：每小时在做什么（工作/娱乐/休息）
- **日级**：工作日 vs 周末的差异
- **周级**：每周习惯变化趋势

#### 2. 应用维度
- **使用时长**：每个应用每天用多久
- **启动频率**：一天启动几次
- **使用时段**：通常什么时候用
- **关联关系**：A 开了通常会开 B

#### 3. 系统维度
- **资源使用**：GPU/CPU/内存高负载时在做什么
- **网络活动**：什么时候流量大
- **文件操作**：什么时候频繁修改文件

#### 4. 行为模式
- **游戏模式**：LOL 游戏时长、频率、时段
- **工作模式**：编程/文档编辑的时间分布
- **娱乐模式**：听音乐、看视频的习惯
- **休息模式**：什么时候系统空闲

## 数据收集

### 应用使用记录（app_usage.jsonl）
```json
{
  "timestamp": 1708668000,
  "app": "QQ音乐",
  "action": "started",
  "hour": 14,
  "weekday": 5,
  "is_weekend": false
}
{
  "timestamp": 1708671600,
  "app": "QQ音乐",
  "action": "stopped",
  "duration_sec": 3600,
  "hour": 15
}
```

### 每日汇总（daily_summary.jsonl）
```json
{
  "date": "2026-02-23",
  "weekday": 0,
  "apps": {
    "QQ音乐": {"duration": 7200, "sessions": 3},
    "LOL": {"duration": 10800, "sessions": 2},
    "WeGame": {"duration": 600, "sessions": 2}
  },
  "peak_hours": [14, 15, 20, 21, 22],
  "activity_type": {
    "gaming": 11400,
    "music": 7200,
    "idle": 5400
  },
  "system": {
    "gpu_avg_temp": 58,
    "gpu_peak_usage": 95,
    "memory_avg": 45
  }
}
```

### 模式库（patterns.json）
```json
{
  "time_patterns": {
    "work_hours": [9, 10, 11, 14, 15, 16],
    "gaming_hours": [20, 21, 22, 23],
    "music_hours": [14, 15, 16, 20, 21]
  },
  "app_associations": {
    "LOL": ["WeGame"],
    "编程": ["QQ音乐"]
  },
  "weekly_habits": {
    "weekday": {
      "gaming_avg": 2.5,
      "work_avg": 6.0
    },
    "weekend": {
      "gaming_avg": 5.0,
      "work_avg": 2.0
    }
  },
  "thresholds": {
    "gaming_session_max": 10800,
    "daily_gaming_max": 18000
  }
}
```

## 模式识别规则

### 规则 1：时间模式
- 统计每小时各类活动的频率
- 识别"工作时间"、"游戏时间"、"休息时间"
- 检测偏离常规的行为

### 规则 2：应用关联
- 计算应用共现频率
- 识别"启动链"（A → B → C）
- 预测下一个可能启动的应用

### 规则 3：健康提醒
- 连续游戏时长监控
- 每日游戏总时长监控
- 深夜活动检测（23:00 后）

### 规则 4：效率优化
- 检测"分心"行为（工作时间频繁切换应用）
- 识别高效时段（长时间专注）
- 建议最佳工作时间

## 智能建议类型

### 1. 健康提醒
- "你已经连续玩了 3 小时 LOL，建议休息 10 分钟"
- "现在是凌晨 2 点，建议早点休息"
- "今天游戏时长已达 5 小时，注意劳逸结合"

### 2. 习惯建议
- "通常这个时间你会听音乐，要不要打开 QQ音乐？"
- "检测到你在编程，要不要打开音乐？"
- "你通常 20:00 开始玩 LOL，现在要准备吗？"

### 3. 效率建议
- "检测到频繁切换应用，当前可能不是最佳工作时间"
- "你的高效时段通常是 14-16 点，建议安排重要任务"
- "检测到大量文件修改，要不要提交 Git？"

### 4. 系统优化
- "检测到即将启动游戏，已清理内存"
- "GPU 温度偏高，建议检查散热"
- "磁盘空间不足，建议清理缓存"

## 实现计划

### Phase 1: 数据收集（第 1-2 周）
**目标**：积累基础数据，建立数据管道

**任务**：
1. 创建 `habit_tracker.py`
   - 监听 AppMonitor 事件
   - 记录应用启动/关闭时间
   - 生成每日汇总

2. 扩展 `sensor_state.json`
   - 添加应用使用历史
   - 记录每小时活动快照

3. 集成到 AIOS Pipeline
   - 每次心跳时更新数据
   - 每日 23:59 生成日报

**验收标准**：
- 能够记录所有应用启动/关闭事件
- 能够生成每日汇总报告
- 数据格式规范，可读性强

### Phase 2: 模式识别（第 3-4 周）
**目标**：从数据中提取模式，建立规则库

**任务**：
1. 创建 `pattern_analyzer.py`
   - 统计时间分布
   - 识别应用关联
   - 检测异常行为

2. 生成模式报告
   - 每周生成一次
   - 可视化展示（文本/图表）

3. 建立阈值
   - 游戏时长阈值
   - 工作时间定义
   - 异常行为判定

**验收标准**：
- 能够识别出"工作时间"、"游戏时间"
- 能够发现应用关联关系
- 能够检测异常行为

### Phase 3: 智能建议（第 5-6 周）
**目标**：基于模式提供主动建议

**任务**：
1. 创建 `predictor.py`
   - 预测下一个可能的行为
   - 计算建议的置信度

2. 新增 Playbook 规则
   - `pb-014-gaming-reminder`：游戏时长提醒
   - `pb-015-habit-suggestion`：习惯建议
   - `pb-016-efficiency-tip`：效率建议

3. 建议过滤机制
   - 避免过度打扰
   - 只在高置信度时建议
   - 冷却时间控制

**验收标准**：
- 建议准确率 > 70%
- 每天建议数量 < 5 条
- 用户接受率 > 50%

### Phase 4: 持续优化（长期）
**目标**：根据反馈持续改进

**任务**：
1. 收集建议反馈
   - 用户是否采纳
   - 建议是否有用

2. 调整模型参数
   - 阈值优化
   - 规则权重调整

3. 新功能扩展
   - 更多维度分析
   - 更智能的预测

## 技术细节

### 数据存储
- 使用 JSONL 格式（追加写入，易于解析）
- 每日汇总单独文件（便于查询）
- 模式库使用 JSON（便于读写）

### 性能优化
- 数据收集异步进行，不阻塞主流程
- 模式分析在低负载时段运行
- 历史数据定期归档（保留最近 3 个月）

### 隐私保护
- 所有数据本地存储
- 不记录具体文件内容
- 不记录键盘输入
- 不记录屏幕截图

### 可扩展性
- 模块化设计，易于添加新维度
- 规则引擎可配置
- 支持自定义阈值

## 成功指标

### 数据质量
- 数据完整性 > 95%
- 数据准确性 > 98%

### 模式识别
- 时间模式识别准确率 > 80%
- 应用关联识别准确率 > 70%

### 用户体验
- 建议有用率 > 60%
- 建议打扰率 < 10%
- 用户满意度 > 4/5

## 风险与对策

### 风险 1：数据不足
- **对策**：Phase 1 至少运行 2 周再进入 Phase 2
- **对策**：提供手动标注功能补充数据

### 风险 2：建议过度
- **对策**：严格控制建议频率
- **对策**：提供"静默时段"配置

### 风险 3：模式误判
- **对策**：建议附带置信度
- **对策**：提供反馈机制修正

### 风险 4：性能影响
- **对策**：异步处理，不阻塞主流程
- **对策**：定期清理历史数据

## 下一步行动

1. ✅ 创建设计文档
2. ⏳ 实现 Phase 1: 数据收集
   - 创建 `habit_tracker.py`
   - 集成到 AIOS Pipeline
   - 测试数据收集
3. ⏳ 运行 2 周积累数据
4. ⏳ 实现 Phase 2: 模式识别
5. ⏳ 实现 Phase 3: 智能建议

---

**文档版本**：v1.0  
**创建时间**：2026-02-23 14:56  
**作者**：小九  
**状态**：设计阶段
