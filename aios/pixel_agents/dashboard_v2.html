<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIOS Pixel Agents - æ™ºèƒ½å·¥ä½œå°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #0a0e27;
            color: #e0e6ed;
            overflow-x: hidden;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 240px;
            height: 100vh;
            background: #0f1629;
            border-right: 1px solid #1a2332;
            padding: 20px 0;
            z-index: 100;
        }

        .logo {
            padding: 0 20px 30px;
            font-size: 18px;
            font-weight: 600;
            color: #00d4ff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo::before {
            content: "ğŸ¤–";
            font-size: 24px;
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #8b92a7;
        }

        .nav-item:hover {
            background: #1a2332;
            color: #00d4ff;
        }

        .nav-item.active {
            background: #1a2332;
            color: #00d4ff;
            border-left: 3px solid #00d4ff;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            margin-left: 240px;
            padding: 30px;
            min-height: 100vh;
        }

        /* é¡¶éƒ¨æ  */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .time-range {
            background: #1a2332;
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid #2a3547;
            color: #8b92a7;
            cursor: pointer;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #1a2332;
            padding: 8px 16px;
            border-radius: 8px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        /* æŒ‡æ ‡å¡ç‰‡ç½‘æ ¼ */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #1a2332 0%, #0f1629 100%);
            border: 1px solid #2a3547;
            border-radius: 12px;
            padding: 24px;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #00d4ff, #0099ff);
        }

        .metric-label {
            font-size: 14px;
            color: #8b92a7;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: #00d4ff;
            margin-bottom: 8px;
        }

        .metric-change {
            font-size: 12px;
            color: #4ade80;
        }

        .metric-change.negative {
            color: #f87171;
        }

        .metric-icon {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 32px;
            opacity: 0.3;
        }

        /* å†…å®¹ç½‘æ ¼ */
        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: #0f1629;
            border: 1px solid #2a3547;
            border-radius: 12px;
            padding: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
        }

        .card-action {
            color: #00d4ff;
            font-size: 14px;
            cursor: pointer;
            text-decoration: none;
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* é¥¼å›¾ */
        .pie-chart {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: conic-gradient(
                #00d4ff 0deg 120deg,
                #4ade80 120deg 240deg,
                #fbbf24 240deg 300deg,
                #f87171 300deg 360deg
            );
            position: relative;
        }

        .pie-chart::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            background: #0f1629;
            border-radius: 50%;
        }

        .pie-legend {
            margin-left: 40px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-label {
            font-size: 14px;
            color: #8b92a7;
            flex: 1;
        }

        .legend-value {
            font-size: 14px;
            font-weight: 600;
            color: #e0e6ed;
        }

        /* æŠ˜çº¿å›¾ */
        .line-chart {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .line-chart svg {
            width: 100%;
            height: 100%;
        }

        /* æ´»åŠ¨åˆ—è¡¨ */
        .activity-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px;
            border-bottom: 1px solid #1a2332;
            transition: background 0.2s;
        }

        .activity-item:hover {
            background: #1a2332;
        }

        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: #1a2332;
        }

        .activity-icon.success {
            background: rgba(74, 222, 128, 0.1);
            color: #4ade80;
        }

        .activity-icon.error {
            background: rgba(248, 113, 113, 0.1);
            color: #f87171;
        }

        .activity-icon.warning {
            background: rgba(251, 191, 36, 0.1);
            color: #fbbf24;
        }

        .activity-info {
            flex: 1;
        }

        .activity-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .activity-meta {
            font-size: 12px;
            color: #8b92a7;
        }

        .activity-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .activity-status.success {
            background: rgba(74, 222, 128, 0.1);
            color: #4ade80;
        }

        .activity-status.error {
            background: rgba(248, 113, 113, 0.1);
            color: #f87171;
        }

        /* å¿«æ·æ“ä½œ */
        .quick-actions {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .action-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 16px;
            background: #1a2332;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .action-item:hover {
            border-color: #00d4ff;
            transform: translateX(5px);
        }

        .action-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .action-info {
            flex: 1;
        }

        .action-title {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .action-desc {
            font-size: 12px;
            color: #8b92a7;
        }

        .action-arrow {
            color: #8b92a7;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f1629;
        }

        ::-webkit-scrollbar-thumb {
            background: #2a3547;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #3a4557;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #2a3547;
            border-top-color: #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* å“åº”å¼ */
        @media (max-width: 1400px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            .main-content {
                margin-left: 0;
            }
            .metrics-grid,
            .content-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- ä¾§è¾¹æ  -->
    <div class="sidebar">
        <div class="logo">AIOS Pixel Agents</div>
        <div class="nav-item active">ğŸ“Š ä»ªè¡¨ç›˜</div>
        <div class="nav-item">ğŸ¤– API è°ƒç”¨</div>
        <div class="nav-item">ğŸ“ˆ ä½¿ç”¨ç»Ÿè®¡</div>
        <div class="nav-item">âš™ï¸ æ¨¡å‹åˆ—è¡¨</div>
        <div class="nav-item">ğŸ”” å‘Šè­¦ç®¡ç†</div>
        <div class="nav-item">ğŸ‘¥ ä¸ªäººèµ„æ–™</div>
    </div>

    <!-- ä¸»å†…å®¹ -->
    <div class="main-content">
        <!-- é¡¶éƒ¨æ  -->
        <div class="header">
            <h1>ä»ªè¡¨ç›˜</h1>
            <div class="header-right">
                <div class="time-range">ğŸ“… 2æœˆ17æ—¥ - 2æœˆ23æ—¥ â–¼</div>
                <div class="user-info">
                    <div class="user-avatar">ğŸ¾</div>
                    <span>çŠç‘šæµ·</span>
                </div>
            </div>
        </div>

        <!-- æŒ‡æ ‡å¡ç‰‡ -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-icon">ğŸ¤–</div>
                <div class="metric-label">æ€» Agents</div>
                <div class="metric-value" id="total-agents">0</div>
                <div class="metric-change">+2 æœ¬å‘¨æ–°å¢</div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">âš¡</div>
                <div class="metric-label">æ´»è·ƒ Agents</div>
                <div class="metric-value" id="active-agents">0</div>
                <div class="metric-change">å®æ—¶è¿è¡Œä¸­</div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">ğŸ“‹</div>
                <div class="metric-label">ä»Šæ—¥ä»»åŠ¡</div>
                <div class="metric-value" id="today-tasks">0</div>
                <div class="metric-change">+15% è¾ƒæ˜¨æ—¥</div>
            </div>

            <div class="metric-card">
                <div class="metric-icon">ğŸ’š</div>
                <div class="metric-label">ç³»ç»Ÿå¥åº·</div>
                <div class="metric-value" id="health-score">0.00</div>
                <div class="metric-change" id="health-change">æ­£å¸¸è¿è¡Œ</div>
            </div>
        </div>

        <!-- å†…å®¹ç½‘æ ¼ -->
        <div class="content-grid">
            <!-- Agent çŠ¶æ€åˆ†å¸ƒ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Agent çŠ¶æ€åˆ†å¸ƒ</div>
                    <a href="#" class="card-action">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
                </div>
                <div class="chart-container">
                    <div class="pie-chart"></div>
                    <div class="pie-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #00d4ff;"></div>
                            <div class="legend-label">è¿è¡Œä¸­ (running)</div>
                            <div class="legend-value" id="running-count">0</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #4ade80;"></div>
                            <div class="legend-label">ç©ºé—² (idle)</div>
                            <div class="legend-value" id="idle-count">0</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #fbbf24;"></div>
                            <div class="legend-label">é˜»å¡ (blocked)</div>
                            <div class="legend-value" id="blocked-count">0</div>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f87171;"></div>
                            <div class="legend-label">é™çº§ (degraded)</div>
                            <div class="legend-value" id="degraded-count">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 24å°æ—¶ä»»åŠ¡è¶‹åŠ¿ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">24å°æ—¶ä»»åŠ¡è¶‹åŠ¿</div>
                    <div style="display: flex; gap: 15px; font-size: 12px;">
                        <span style="color: #00d4ff;">â— æˆåŠŸ</span>
                        <span style="color: #f87171;">â— å¤±è´¥</span>
                        <span style="color: #fbbf24;">â— è­¦å‘Š</span>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="trend-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- åº•éƒ¨ç½‘æ ¼ -->
        <div class="content-grid">
            <!-- æœ€è¿‘æ´»åŠ¨ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">æœ€è¿‘æ´»åŠ¨</div>
                    <a href="#" class="card-action">æŸ¥çœ‹å…¨éƒ¨ â†’</a>
                </div>
                <div class="activity-list" id="activity-list">
                    <div style="text-align: center; padding: 40px; color: #8b92a7;">
                        <div class="loading"></div>
                        <div style="margin-top: 10px;">åŠ è½½ä¸­...</div>
                    </div>
                </div>
            </div>

            <!-- å¿«æ·æ“ä½œ -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">å¿«æ·æ“ä½œ</div>
                </div>
                <div class="quick-actions">
                    <div class="action-item" onclick="createAgent()">
                        <div class="action-icon">â•</div>
                        <div class="action-info">
                            <div class="action-title">åˆ›å»º Agent</div>
                            <div class="action-desc">å¿«é€Ÿåˆ›å»ºæ–°çš„æ™ºèƒ½ä»£ç†</div>
                        </div>
                        <div class="action-arrow">â†’</div>
                    </div>
                    <div class="action-item" onclick="viewQueue()">
                        <div class="action-icon">ğŸ“‹</div>
                        <div class="action-info">
                            <div class="action-title">æŸ¥çœ‹ä»»åŠ¡é˜Ÿåˆ—</div>
                            <div class="action-desc">ç®¡ç†å¾…å¤„ç†ä»»åŠ¡</div>
                        </div>
                        <div class="action-arrow">â†’</div>
                    </div>
                    <div class="action-item" onclick="viewAgentEvolution()">
                        <div class="action-icon">ğŸ§¬</div>
                        <div class="action-info">
                            <div class="action-title">Agent è¿›åŒ–æŠ¥å‘Š</div>
                            <div class="action-desc">æŸ¥çœ‹ Agent å­¦ä¹ å’Œä¼˜åŒ–çŠ¶æ€</div>
                        </div>
                        <div class="action-arrow">â†’</div>
                    </div>
                    <div class="action-item" onclick="viewAlerts()">
                        <div class="action-icon">ğŸ””</div>
                        <div class="action-info">
                            <div class="action-title">å‘Šè­¦ç®¡ç†</div>
                            <div class="action-desc">æŸ¥çœ‹ç³»ç»Ÿå‘Šè­¦å’Œé€šçŸ¥</div>
                        </div>
                        <div class="action-arrow">â†’</div>
                    </div>
                    <div class="action-item" onclick="viewConfig()">
                        <div class="action-icon">âš™ï¸</div>
                        <div class="action-info">
                            <div class="action-title">ç³»ç»Ÿé…ç½®</div>
                            <div class="action-desc">è°ƒæ•´ç³»ç»Ÿå‚æ•°å’Œè®¾ç½®</div>
                        </div>
                        <div class="action-arrow">â†’</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:9092';

        // HTTP è½®è¯¢
        let pollingTimer = null;
        function startPolling() {
            if (pollingTimer) return;
            
            // ç«‹å³åŠ è½½ä¸€æ¬¡
            loadDashboardData();
            
            // æ¯ 5 ç§’åˆ·æ–°
            pollingTimer = setInterval(loadDashboardData, 5000);
        }

        function stopPolling() {
            if (pollingTimer) {
                clearInterval(pollingTimer);
                pollingTimer = null;
            }
        }

        async function loadDashboardData() {
            try {
                // å¹¶è¡ŒåŠ è½½æ‰€æœ‰æ•°æ®
                const [agentStats, tasks, events, alerts, health] = await Promise.all([
                    fetch(`${API_BASE}/api/agents/stats`).then(r => r.json()),
                    fetch(`${API_BASE}/api/tasks`).then(r => r.json()),
                    fetch(`${API_BASE}/api/events?limit=20`).then(r => r.json()),
                    fetch(`${API_BASE}/api/alerts`).then(r => r.json()),
                    fetch(`${API_BASE}/api/system/health`).then(r => r.json())
                ]);

                updateDashboard({
                    agents: agentStats,
                    tasks: tasks.tasks || [],
                    events: events.events || [],
                    alerts: alerts.alerts || [],
                    health: health
                });
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ›´æ–°ä»ªè¡¨ç›˜
        function updateDashboard(data) {
            // æ›´æ–°æŒ‡æ ‡å¡ç‰‡
            document.getElementById('total-agents').textContent = data.agents?.total || 0;
            document.getElementById('active-agents').textContent = data.agents?.active || 0;
            document.getElementById('today-tasks').textContent = data.tasks?.length || 0;
            
            const score = data.health?.evolution_score || 0;
            document.getElementById('health-score').textContent = score.toFixed(2);
            
            const healthChange = document.getElementById('health-change');
            if (score >= 0.6) {
                healthChange.textContent = 'å¥åº·è¿è¡Œ';
                healthChange.className = 'metric-change';
            } else if (score >= 0.4) {
                healthChange.textContent = 'è½»å¾®é™çº§';
                healthChange.className = 'metric-change negative';
            } else {
                healthChange.textContent = 'éœ€è¦å…³æ³¨';
                healthChange.className = 'metric-change negative';
            }

            // æ›´æ–° Agent çŠ¶æ€åˆ†å¸ƒ
            const states = data.agents?.by_state || {};
            document.getElementById('running-count').textContent = states.running || 0;
            document.getElementById('idle-count').textContent = states.idle || 0;
            document.getElementById('blocked-count').textContent = states.blocked || 0;
            document.getElementById('degraded-count').textContent = states.degraded || 0;

            // æ›´æ–°é¥¼å›¾
            updatePieChart(states);

            // æ›´æ–°æ´»åŠ¨åˆ—è¡¨
            updateActivityList(data.events || []);
        }

        // æ›´æ–°é¥¼å›¾
        function updatePieChart(states) {
            const total = (states.running || 0) + (states.idle || 0) + (states.blocked || 0) + (states.degraded || 0);
            if (total === 0) return;

            const running = (states.running || 0) / total * 360;
            const idle = (states.idle || 0) / total * 360;
            const blocked = (states.blocked || 0) / total * 360;
            const degraded = (states.degraded || 0) / total * 360;

            const pieChart = document.querySelector('.pie-chart');
            pieChart.style.background = `conic-gradient(
                #00d4ff 0deg ${running}deg,
                #4ade80 ${running}deg ${running + idle}deg,
                #fbbf24 ${running + idle}deg ${running + idle + blocked}deg,
                #f87171 ${running + idle + blocked}deg 360deg
            )`;
        }

        // æ›´æ–°æ´»åŠ¨åˆ—è¡¨
        function updateActivityList(events) {
            const list = document.getElementById('activity-list');
            if (events.length === 0) {
                list.innerHTML = '<div style="text-align: center; padding: 40px; color: #8b92a7;">æš‚æ— æ´»åŠ¨è®°å½•</div>';
                return;
            }

            list.innerHTML = events.slice(0, 10).map(event => {
                const isSuccess = event.type.includes('success') || event.type.includes('completed');
                const isError = event.type.includes('error') || event.type.includes('failed');
                const iconClass = isSuccess ? 'success' : (isError ? 'error' : 'warning');
                const icon = isSuccess ? 'âœ“' : (isError ? 'âœ—' : 'âš ');
                
                const time = new Date(event.timestamp * 1000).toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="activity-item">
                        <div class="activity-icon ${iconClass}">${icon}</div>
                        <div class="activity-info">
                            <div class="activity-title">${event.type}</div>
                            <div class="activity-meta">${time} Â· ${event.source}</div>
                        </div>
                        <div class="activity-status ${iconClass}">
                            ${isSuccess ? 'æˆåŠŸ' : (isError ? 'å¤±è´¥' : 'è­¦å‘Š')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // å¿«æ·æ“ä½œ
        async function createAgent() {
            // åˆ›å»ºæ¨¡æ€æ¡†
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 1000;
            `;
            
            modal.innerHTML = `
                <div style="background: #0f1629; border: 1px solid #2a3547; border-radius: 12px; padding: 30px; max-width: 500px; width: 90%;">
                    <h2 style="margin: 0 0 20px; font-size: 20px;">åˆ›å»º Agent</h2>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: #8b92a7;">Agent ç±»å‹</label>
                        <select id="agent-template" style="width: 100%; padding: 10px; background: #1a2332; border: 1px solid #2a3547; border-radius: 8px; color: #e0e6ed; font-size: 14px;">
                            <option value="coder">ğŸ”§ Coder - ä»£ç å¼€å‘</option>
                            <option value="analyst">ğŸ“Š Analyst - æ•°æ®åˆ†æ</option>
                            <option value="monitor">ğŸ“ˆ Monitor - ç³»ç»Ÿç›‘æ§</option>
                            <option value="researcher">ğŸ” Researcher - ç ”ç©¶è°ƒç ”</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; color: #8b92a7;">ä»»åŠ¡æè¿°ï¼ˆå¯é€‰ï¼‰</label>
                        <textarea id="agent-task" rows="3" placeholder="è¾“å…¥ä»»åŠ¡æè¿°..." style="width: 100%; padding: 10px; background: #1a2332; border: 1px solid #2a3547; border-radius: 8px; color: #e0e6ed; font-size: 14px; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button id="cancel-btn" style="padding: 10px 20px; background: #2a3547; border: none; border-radius: 8px; color: #e0e6ed; cursor: pointer; font-size: 14px;">å–æ¶ˆ</button>
                        <button id="create-btn" style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 8px; color: #fff; cursor: pointer; font-size: 14px;">åˆ›å»º</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // å–æ¶ˆæŒ‰é’®
            modal.querySelector('#cancel-btn').onclick = () => {
                document.body.removeChild(modal);
            };
            
            // åˆ›å»ºæŒ‰é’®
            modal.querySelector('#create-btn').onclick = async () => {
                const template = modal.querySelector('#agent-template').value;
                const task = modal.querySelector('#agent-task').value.trim();
                
                try {
                    const response = await fetch(`${API_BASE}/api/agents/create`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ template, task })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        document.body.removeChild(modal);
                        alert(`âœ… Agent åˆ›å»ºæˆåŠŸ!\n\nID: ${result.agent.id}\nåç§°: ${result.agent.name}\nç±»å‹: ${result.agent.template}`);
                        loadDashboardData(); // åˆ·æ–°æ•°æ®
                    } else {
                        alert('âŒ åˆ›å»ºå¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯'));
                    }
                } catch (error) {
                    alert('âŒ è¯·æ±‚å¤±è´¥: ' + error.message);
                }
            };
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.onclick = (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            };
        }

        async function viewQueue() {
            try {
                const response = await fetch(`${API_BASE}/api/tasks`);
                const data = await response.json();
                const tasks = data.tasks || [];
                
                if (tasks.length === 0) {
                    alert('ğŸ“‹ ä»»åŠ¡é˜Ÿåˆ—ä¸ºç©º');
                    return;
                }
                
                let message = `ğŸ“‹ ä»»åŠ¡é˜Ÿåˆ— (${tasks.length} ä¸ªä»»åŠ¡)\n\n`;
                tasks.slice(0, 10).forEach((task, i) => {
                    const time = new Date(task.timestamp * 1000).toLocaleString('zh-CN');
                    message += `${i + 1}. ${task.task_type || 'unknown'}\n`;
                    message += `   çŠ¶æ€: ${task.status || 'pending'}\n`;
                    message += `   æ—¶é—´: ${time}\n\n`;
                });
                
                alert(message);
            } catch (error) {
                alert('âŒ åŠ è½½å¤±è´¥: ' + error.message);
            }
        }

        async function viewAgentEvolution() {
            // è·å–æ‰€æœ‰ Agent
            try {
                const response = await fetch(`${API_BASE}/api/agents`);
                const data = await response.json();
                const agents = data.agents || [];
                
                if (agents.length === 0) {
                    alert('æš‚æ—  Agent');
                    return;
                }
                
                // é€‰æ‹© Agent
                const agentList = agents.map((a, i) => `${i + 1}. ${a.name} (${a.id})`).join('\n');
                const choice = prompt(`é€‰æ‹© Agent:\n\n${agentList}\n\nè¯·è¾“å…¥æ•°å­—:`);
                
                if (!choice) return;
                
                const index = parseInt(choice) - 1;
                if (index < 0 || index >= agents.length) {
                    alert('æ— æ•ˆçš„é€‰æ‹©');
                    return;
                }
                
                const agent = agents[index];
                
                // è·å–è¿›åŒ–æŠ¥å‘Š
                const reportResponse = await fetch(`${API_BASE}/api/agents/${agent.id}/report`);
                const reportData = await reportResponse.json();
                
                alert(reportData.report);
            } catch (error) {
                alert('âŒ åŠ è½½å¤±è´¥: ' + error.message);
            }
        }

        async function viewAlerts() {
            try {
                const response = await fetch(`${API_BASE}/api/alerts`);
                const data = await response.json();
                const alerts = data.alerts || [];
                
                if (alerts.length === 0) {
                    alert('ğŸ”” æš‚æ— å‘Šè­¦');
                    return;
                }
                
                let message = `ğŸ”” å‘Šè­¦åˆ—è¡¨ (${alerts.length} ä¸ª)\n\n`;
                alerts.slice(0, 10).forEach((alert, i) => {
                    const time = new Date(alert.timestamp * 1000).toLocaleString('zh-CN');
                    message += `${i + 1}. ${alert.type || 'unknown'}\n`;
                    message += `   çº§åˆ«: ${alert.severity || 'unknown'}\n`;
                    message += `   çŠ¶æ€: ${alert.state || 'OPEN'}\n`;
                    message += `   æ—¶é—´: ${time}\n\n`;
                });
                
                alert(message);
            } catch (error) {
                alert('âŒ åŠ è½½å¤±è´¥: ' + error.message);
            }
        }

        function viewConfig() {
            alert('âš™ï¸ ç³»ç»Ÿé…ç½®\n\nAPI åœ°å€: ' + API_BASE + '\nè½®è¯¢é—´éš”: 5 ç§’\n\næ›´å¤šé…ç½®åŠŸèƒ½å¼€å‘ä¸­...');
        }

        // åˆå§‹åŒ–
        startPolling();

        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', () => {
            stopPolling();
        });
    </script>
</body>
</html>
